FROM public.ecr.aws/lambda/python:3.11

WORKDIR /var/task
RUN mkdir -p python

# Install specific versions known to have pre-compiled wheels
RUN pip install --only-binary=:all: --no-compile \
    pandas==2.1.4 \
    numpy==1.24.3 \
    -t python/

# Clean up
RUN find python -name "*.pyc" -delete
RUN find python -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true